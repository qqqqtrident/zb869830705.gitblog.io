---
layout: post
author: Robin
title: 简明数据科学 第6部分：模型选择方法
tags: [数据科学]
categories:
  - 数据科学 
--- 

_原文地址：https://towardsdatascience.com/data-science-simplified-part-6-model-selection-methods-2511cbdf7cb0_

在上一篇文章中，我们介绍了多元回归模型，费尔南多构建了一个多元线性回归模型，接受五个参数来预测汽车的价格。

![](/assets/simple_data_science/6/0_last_result.png)

从最后的结果来看，费尔南多的确构建了一个很好的模型，但是他还想选择出最佳的输入参数。那么这篇文章我们将讨论**模型的选择方法**。

## 基本概念

模型选择方法的思路其实比较直观，只要回答了下面的问题即可：

**如何为最优模型选择正确的输入变量？**

开始之前，我们需要了解**如何定义最佳模型？**

![](/assets/simple_data_science/6/define_best_model.png)

**最佳模型是适合评估指标最佳值的数据模型。**

模型的评估有很好的指标，而**调整R平方是多元回归模型的最好评价指标**。

对于选择最佳参数集来说，有三种方法，他们是：

* 最佳子集法
* 前向逐步选择法
* 后向逐步选择法

接下来分别对这三种方法进行介绍。

## 最佳子集法

![](/assets/simple_data_science/6/best_subset.png)

如上图所示，假设我们有*k*个变量，那么最佳子集法的过程如下：

1. 从空模型开始，即没有预测器的模型，我们称之为M0；
2. 用1个变量找出最佳模型，此时，该模型是一个简单的单一变量回归模型，只有一个独立变量，称之为M1；
3. 用2个变量找出最佳模型，该模型是一个只有两个独立变量的回归模型，称之为M2；
4. 用2个变量找出最佳模型，该模型是一个有三个独立变量的回归模型，称之为M3；
5. 重复这些步骤，只到找出最佳模型的所有预测变量的组合。

对于k个变量，我们需要从下面的模型中找出一组表现最佳的模型：

* M1： 具有1个预测器的最优模型；
* M2： 具有2个预测器的最优模型；
* M3： 具有3个预测器的最优模型；
* Mk： 具有k个预测器的最优模型。

然后选择M1...Mk中最优的模型，也就是最适合的模型。

最佳子集法是一个复杂的处理过程，不仅需要梳理了预测变量的列表，而且还需要选择最佳的变量组合。最佳子集法虽然看似简单，但是它有着子集的困难和挑战。

最佳子集法为每个预测变量及其组合创建一个模型，这意味着我们正在为每个变量组合创建模型。模型的数量可以是一个非常大的数字。

如果有2个变量，那么有4个可能的模型，如果有3个变量，那么有8个可能的模型。一般来说，如果有p个变量，那么就有2 ^ p个可能的模型，这是相当多的模型可供选择。想象一下，有100个变量（很常见）。将会有**2 ^ 100**个可能的模型。令人难以置信的数字。

在费尔南多的情况下，只有5个变量，他将不得不创造和选择*2 ^ 5*个模型，即32个不同的模型。

## 前向逐步选择法

![](/assets/simple_data_science/6/forward_stepwise.png)

至此，对**最佳子集法**已经有了一个了解了，但是它需要很多的计算能力，也相对比较耗时，而**前向逐步选择法**试图环节这种困难。

依然，假设我们有k个变量，则逐步前进选择法的步骤如下：

1. 从空模型开始，即没有预测器的模型，我们称之为M0。将预测变量添加到模型中，一次仅添加一个；
2. 用1个变量找出最佳模型，此时，该模型是一个简单的单一变量回归模型，只有一个独立变量，称之为M1；
3. 在M1的基础上，增加一个变量，用2个变量找出最佳模型，称之为M2；
4. 在M2的基础上，增加一个变量，用3个变量找出最佳模型，称之为M3；
5. 重复这些步骤，只到找出最佳模型Mk，即有k个变量的模型。

对于k个变量，我们需要从以下一组模型中选择最优模型：

* M1： 具有1个预测器的最优模型；
* M2： 具有2个预测器的最优模型，该模型是M1 + 一个额外的变量；
* M3： 具有3个预测器的最优模型，该模型是M2 + 一个额外的变量；
* Mk： 具有k个预测器的最优模型，该模型是Mk-1 + 一个额外的变量。

再次选择M1 ... Mk中的最佳模型，即具有最佳拟合的模型

与最佳子集法相比，前向逐步选择法法创建更少的模型。如果有p个变量，那么将会有大约*p（p + 1）/ 2 + 1*个模型可供选择，远低于最佳子集方法中的模型选择。假设有100个变量，则基于前向逐步法创建的模型的数量是*100×101/2 + 1*，即5051个模型。

在费尔南多的情况下，只有5个变量，他将不得不创建和选择*5 * 6/2 + 1*模型，即16个不同的模型。

## 后向逐步选择法

![](/assets/simple_data_science/6/backward_stepwise.png)

现在我们已经理解了模型选择的前向逐步选择过程，接下来看看**后向逐步选择法**，这是前向逐步选择法的反向。前向逐步选择从没有变量的模型即空模型开始，相比之下，后向逐步选择是从所有变量开始的。后向逐步选择法的过程如下：

假设我们有k个变量，则逐步前进选择法的步骤如下：

1. 从一个完整的模型开始，即包含所有预测变量的模型，我们称这个模型为Mk。从完整模型中删除预测变量。一次一个；
2. 用k-1个变量找出最优模型，从Mk中删除一个变量。计算所有可能组合模型的性能。选择具有k-1个变量的最佳模型。我们称这个模型为Mk-1；
3. 用k-2个变量找到最优模型，从Mk-1中删除一个变量。计算所有可能组合模型的性能。选择具有k-2个变量的最佳模型。我们称这个模型为Mk-2；
4. 重复这些步骤，只到找出最佳模型M1，即有1个变量的模型。

对于k个变量，我们需要从以下一组模型中选择最优模型：

* Mk：具有k个预测值的最优模型；
* Mk-1：具有k-1个预测变量的最优模型。这个模型是 MK - 一个额外的变量；
* Mk-2：具有k-2个预测变量的最优模型。这个模型是 MK - 两个额外的变量；
* M1：具有1个预测器的最优模型。

## 模型构建

了解了模型选择的方法之后，让我们回到费尔南多的问题，回想一下前一篇文章，费尔南多有6个变量发动机大小，马力，峰值RPM，长度，宽度和高度，他想通过创建一个多元回归模型来估算汽车价格。他想保持模型的平衡并选择最佳的模式。

于是，费尔南多准备使用前向逐步选择法，统计软件包计算出了所有可能的模型以及输出M1到M6的结果。

![](/assets/simple_data_science/6/model_building.png)

让我们解释上述结果：

* Model 1：只有一个预测器，仅使用发动机的大小作为变量，调整的R平方为0.77；
* Model 2：仅有两个预测器，使用发动机大小和马力作为变量，调整的R平方为0.79；
* Model 3：仅有三个预测器，使用发动机大小、马力和宽度作为变量，调整的R平方为0.82；
* Model 4：仅有四个预测器，使用发动机大小、马力、宽度和高度作为变量，调整的R平方为0.82；
* Model 5：仅有五个预测器，使用发动机大小、马力、宽度、高度和峰值RPM作为变量，调整的R平方为0.82；
* Model 6：仅有六个预测器，使用发动机大小、马力、宽度、高度、高度和峰值RPM作为变量，调整的R平方为0.82。

最终，费尔南多选择了最好的、最简单的模型。在上述结果中，Model 3 使用发动机大小、马力和宽度作为变量，该模型能够得到0.82的调整R平方，即说明该模型可以解释82%的训练数据变化，其他Model 4、5、6虽然使用了更多的变量，但是得到的调整R平方依然是0.82，相对于Model 3却更加的复杂。

在费尔南多的统计软件包中，同样输出了如下的系数结果：

![](/assets/simple_data_science/6/coefficients.png)

根据发动机尺寸，马力和宽度估算价格。

** 价格 = -55089.98 + 87.34 * 发动机大小 + 60.93 * 马力+ 770.42 * 宽度 **

## 模型评估

费尔南多选择了最好的模型，该模型将使用发动机尺寸，马力和汽车宽度估算价格。他希望评估模型在训练和测试数据上的表现。

之前，他已经将数据分成了训练集和测试集，费尔南多使用训练数据训练模型，对于模型来说此时测试数据是不可见的数据。费尔南多评估模型在测试数据上的表现。

![](/assets/simple_data_science/6/result.png)

在训练数据上，模型表现相当好,调整的R平方为0.815，说明该模型可以解释81％的训练数据变化。但是，对于该模型来说，在测试数据集上的表现更为重要。

![](/assets/simple_data_science/6/model_evo.png)

费尔南多测试了模型在测试数据集上的表现性能，得到该模型在测试数据中的调整的R平方为0.7984。这意味着即使对于看不见的数据，模型也可以解释79.84％的变化。

## 结束

现在，费尔南多有了一个简单而且有效的模型来预测汽车的价格。但是，发动机大小，马力和宽度的单位是不同的。于是他想到了如下的几个问题：

* 如何使用常见的比较单位来估算价格变化？
* 关于发动机尺寸、马力和宽度的对应价格有多少弹性变化？

下一篇文章我们将讨论转换多元回归模型以及计算弹性的方法。