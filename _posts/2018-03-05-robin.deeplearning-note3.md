---
layout: post
author: Robin
title: 【Robin.DeepLearning】 三、Hello 神经网络（二）--- 神经网络的数据表示
tags: 机器学习
categories:
  - 机器学习
---

## 2.2 神经网络的数据表示

在上一个手写数字分类的例子中，数据的存储格式为多维的Numpy数组，而这个多维数组也称之为**张量（tensor）**。当前流行的机器学习系统都以张量作为基本的数据结构，例如TensorFlow。

### 2.2.1 什么是张量？

简单地说，张量就是数据的容器（container）。而这里的数据通常是数值型数据，所以张量也可以称为是数字的容器。例如矩阵是二维（2D）张量，而张量是广义的矩阵。

* 标量（Scalar，0D张量）

只包含一个数字的张量称为标量（或者数量张量，零维张量，0D张量）。在Numpy中，一个float32或者float64位的数值就是数量张量。Numpy中的张量，可以使用其`ndim`属性显示轴的序数，数量张量有0个轴（ndim == 0）。张量的轴的序数也称为阶（rank）。下面是Numpy的数量张量：

```python
>>> import numpy as np
>>> x = np.array(11)
>>> x
array(11)
>>> x.ndim
0
```

* 向量（Vector，1D张量）

数字的数组称为向量，或者一维张量（1D张量）。一维张量只有一个轴。下面是Numpy的向量：

```python
>>> import numpy as np
>>> x = np.array([1,2,3,4,5])
>>> x
array([1, 2, 3, 4, 5])
>>> x.ndim
1
```
该向量有5项，也称为5维的向量。但是不能混淆5D向量和5D张量！一个5D向量只有一个轴，以及沿该轴有5个维数（元素）；然而一个5D张量有5个轴，并且沿每个轴可以有任意个的维数。维度既能表示沿某个轴的项的数量（比如，上面的5D向量），又能表示一个张量中轴的数量（比如，上面的5D张量）。对于5D张量，也可以成为5阶张量（张量的阶即轴的数量）。

* 矩阵（Matrix，2D张量）

向量的数组称为矩阵，或者二维张量（2D张量）。矩阵有两个轴，也常称为行和列。下面是Numpy矩阵：

```python
>>> import numpy as np
>>> x = np.array([[2,3,4],[4,5,6],[7,6,3],[3,4,5]])
>>> x
array([[2, 3, 4],
       [4, 5, 6],
       [7, 6, 3],
       [3, 4, 5]])
>>> x.ndim
2
```
沿着第一个轴的项称为行，沿着第二个轴的项称为列。在上面的例子中，[2, 3, 4]是矩阵x第一行，[2，4，7，3]是矩阵x的第一列。

* 三维张量（3D张量）和更高维张量

矩阵的数组称为三维张量（3D张量），可以将其看成是数字排列成的立方体。下面是Numpy的三维张量：

```python
>>> import numpy as np
>>> x = np.array([[[5, 78, 2, 34, 0],
...                    [6, 79, 3, 35, 1],
...                    [7, 80, 4, 36, 2]],
...                    [[5, 78, 2, 34, 0],
...                    [6, 79, 3, 35, 1],
...                    [7, 80, 4, 36, 2]],
...                    [[5, 78, 2, 34, 0],
...                    [6, 79, 3, 35, 1],
...                    [7, 80, 4, 36, 2]]])
>>> x
array([[[ 5, 78,  2, 34,  0],
        [ 6, 79,  3, 35,  1],
        [ 7, 80,  4, 36,  2]],

       [[ 5, 78,  2, 34,  0],
        [ 6, 79,  3, 35,  1],
        [ 7, 80,  4, 36,  2]],

       [[ 5, 78,  2, 34,  0],
        [ 6, 79,  3, 35,  1],
        [ 7, 80,  4, 36,  2]]])
>>> x.ndim
3
```
同理，将三维张量放进数组可以创建四维张量，其它更高维的张量亦是如此。深度学习中常用的张量是 0D 到 4D。如果处理视频数据，你会用到5D。

### 2.2.2 张量的关键属性

张量具有如下三个关键的属性：

* 轴的数量（阶数，rank）：一个三维张量有3个轴，矩阵有2个轴，Numpy中的张量维度为`ndim`。

* 形状（shape）：它是一个整数元组，描述张量沿每个轴有多少维。例如，前面的例子中，矩阵的形状为（4，3），三维张量的形状为（3，3，5）。向量的形状只有三个元素，比如（3，），标量有空形状，（）。

* 数据类型：张量中包含的数据类型有float32，unit8，float64等等，调用Python的dtype属性获取。字符型张量是极少见的。注意，Numpy中不存在字符串张量，其它大部分库也不存在。因为张量存在于预先申请的、连续的内存分段；而字符是变长的。

再回到MNIST数据集，查看其相关数据属性，加载MNIST数据集：

```python
from keras.datasets import mnist
(train_images, train_labels), (test_images, test_labels) = mnist.load_data()
```

接着，使用`ndim`属相显示张量train_images的轴数量：

```python
>>> print(train_images.ndim)
3
```

打印形状：

```python
>>> print(train_images.shape)
(60000, 28, 28)
```

使用`dtype`属性打印数据类型：

```python
>>> print(train_images.dtype)
uint8
```

所以train_images是一个8-bit 整数的三维张量。更确切地说，它是一个包含60,000个矩阵的数组，其中每个矩阵是28 x 28 的整数。每个矩阵是一个灰度图，其值为0到255。

也可以使用Matplotlib库显示三维张量中的第4幅数字图：

```python
>>> import matplotlib.pyplot as plt
>>> digit = train_images[4]
>>> plt.imshow(digit, cmap=plt.cm.binary)
<matplotlib.image.AxesImage object at 0x114ce10f0>
>>> plt.show()
```
![](/assets/robin.deeplearning/3/Figure_1.png)

### 2.2.3 张量的操作

上面的例子中，使用了train_images[i]沿第一个轴选择指定的数字图。选择张量的指定元素称为张量分片（tensor slicing），下面看Numpy数组中的张量切片操作。

选择#10到#100（不包括#100）的数字图，对应的张量形状为（90，28，28）：

```python
>>> my_slice = train_images[10:100]
>>> print(my_slice.shape)
(90, 28, 28)
```

其等效的表示方法有，沿每个轴为张量分片指定起始索引和终止索引。注意，`:`等效于选择整个轴的数据：

```python
>>> my_slice = train_images[10:100, :, :]
>>> my_slice.shape
(90, 28, 28)
>>> my_slice = train_images[10:100, 0:28, 0:28]
>>> my_slice.shape
(90, 28, 28)
```

一般，你可以沿着张量每个轴任意选择两个索引之间的元素。例如，选择所有图片的右下角的14 x 14的像素：

```python
my_slice = train_images[:, 14:, 14:]
```

你也可以用负索引。就像Python list中的负索引一样，它表示相对于当前轴末端的位置。剪切图片中间14 x 14像素，使用如下的方法：

```
my_slice = train_images[:, 7:-7, 7:-7]
```

### 2.2.4 批量数据（batch data）的表示

在深度学习中，张量数据的第一个轴（axis 0，轴的序数从0开始）一般是样本轴（sample axis），有时也称为样本维度（sample dimension ）。在MNIST手写数字识别的例子中，样本是数字图片。

另外，深度学习模型不会一次处理整个数据集，而是将其拆分成小批量的数据集。下面是一个MNIST手写数字的batch，其中batch大小为128:

```python
batch = train_images[:128]
```
接着下一个batch：

```python
batch = train_images[128:256]
```

第n个batch：

```python
batch = train_images[128 * n:128 * (n + 1)]
```
对于张量batch来说，第一个轴（axis 0）称为batch轴或者batch维度。

### 2.2.5 真实世界中的张量

大部分的张量都可以归为一下几大类：

一、 向量数据：形状为（样本，特征）[^ (samples, features) ]的二维张量。

向量数据是最常见的例子。在数据集中，单个数据点可以编码成一个向量，然后一批向量数据可以编码成二维张量（即，向量的数组），其中第一个轴为样本轴（samples axis），第二个轴为特征轴（features axis）。

两个实例：

* 人口数据：这里考虑人的年龄，邮政编码和收入。每个人的特征是一个包含3个值的向量，因此100,000个人的数据集存储为形状为（100000，3）的二维张量

* 文本数据：这里每个文档用词汇表（考虑20,000个常用词的字典）中每个词出现的次数来表示。那么每个文档编码成一个包含20,000个值（词汇表中每个词一个值）的向量。因此，500个文档的数据集存储为形状为（500，20000）的张量

二、 时序数据（timeseries data）或者序列数据（sequence data）：形状为（样本，时间戳，特征）[^(samples, timesteps, features)]的三维张量。

当样本数据集中时间或者序列的排序较为重要，你应该将数据集存储为带显式的时间轴（time axis）的三维张量。每个样本编码成一个向量的序列（二维张量），因此，一批二维张量数据可以编码成三维张量。如下图：

![](/assets/robin.deeplearning/3/note3_times_data.png)

习惯上，时间轴是第二个轴（轴序数为1）。下面看几个例子：

* 股票价格数据：每分钟保存股票的当前价格，上一分钟的最高价格，上一分钟的最低价格。每分钟的股票价格编码成一个三维向量，一整天的股票交易编码成形状为（390，3）的二维张量（股票交易每天有390分钟）。250天的股票数据存储为（250，390，3）的三维张量。这里每个样本为一天的股票交易数据。
* 推特消息数据：这里用128个不重复的字符表将每条推文编码成280字符序列。每个字符编码成大小为128的二进制向量（该字符所在的索引位置的项为1，其它值都为0）。每条推文编码成形状为（280，128）的二维张量，那么1亿条推文存储为（1000000，280，128）的张量。

三、 图片数据：形状为（样本，高度，宽度，管道）[^(samples, height, width, channels)]或者（样本，管道，高度，宽度）[^(samples, channels, height, width)]的四维张量。

图片典型有三个维度：高度、宽度和颜色深度。灰度图片（比如MNIST手写数字图片）仅有一个颜色通道，因此可以存储为二维张量，但是习惯上图片张量都是三维的，因此灰度图片只用一维颜色管道表示。128张大小为256 x 256的灰度图片存储成形状为（128，256，256，1）的张量，128张彩色图片存储成形状为（128，256，256，1）的张量。如下图：

![](/assets/robin.deeplearning/3/note3_img_data.png)

图片张量有两种写法：颜色管道在后（TensorFlow的写法），颜色管道在前（Theano的写法）。谷歌的TensorFlow机器学习框架将颜色深度轴放在末尾：（样本，高度，宽度，管道）[^(samples, height, width, channels)]。同时，Theano将颜色深度轴放在batch轴右边。按Theano的写法，前面的例子写成（128，1，256，256）和（128，3，256，256）。Keras深度学习框架对两种表示方法都支持。s

四、 视频数据：形状为（样本，帧，高度，宽度，管道）[^(samples, frames, height, width, channels)]或者（样本，帧，管道，高度，宽度）[^(samples, frames, channels, height, width)]的五维张量。

视频数据是现实世界中少有的几种需用五维张量表示的数据。视频可以理解成帧的序列，每帧是一副彩色图片。因为每帧是三维张量（高度，宽度，管道），所以帧的序列存储成四维张量（帧，高度，宽度，管道）。那不同的视频就要存储为五维张量了（样本，帧，高度，宽度，管道）[^(samples, frames, height, width, channels)]。

例如，一个60秒，144 x 256的油管视频按每秒采样4帧将会有240帧。那么4个不同的视频采样存储为形状为（4，240，144，256，3），总共有106,168,320个值。如果数据类型dtype为float32，那每个值保存为32位，所以该张量表示占405MB。而在真实生活中，你看到的视频都不用float32保存，一般都用大块数据存储格式（比如MPEG格式）压缩。


